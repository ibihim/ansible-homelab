# {{ ansible_managed }}
# Based on https://github.com/drduh/config/blob/main/sshd_config

Port {{ security_ssh_port }}
AddressFamily inet

# Cryptography
Ciphers aes256-gcm@openssh.com
MACs hmac-sha2-512-etm@openssh.com
KexAlgorithms curve25519-sha256@libssh.org,diffie-hellman-group-exchange-sha256
HostKeyAlgorithms rsa-sha2-512,rsa-sha2-256,ssh-ed25519
RekeyLimit 1G 1H

# Authentication
AllowUsers {{ user }}
LoginGraceTime 30s
MaxAuthTries 2
MaxStartups 1
MaxSessions 2
PermitRootLogin no
StrictModes yes
PubkeyAuthentication yes
AuthorizedKeysFile %h/.ssh/authorized_keys
PasswordAuthentication {{ security_ssh_password_auth }}
PermitEmptyPasswords no
HostbasedAuthentication no
KbdInteractiveAuthentication no
IgnoreRhosts yes

# Network
AllowAgentForwarding no
AllowTcpForwarding no
X11Forwarding no
GatewayPorts no
PermitTunnel no

# Session
ClientAliveInterval 30
ClientAliveCountMax 20
Compression delayed
UseDNS no
PrintMotd no
PrintLastLog yes
PermitUserEnvironment no

# Logging
SyslogFacility AUTH
LogLevel VERBOSE
